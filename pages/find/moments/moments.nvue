<template>
	<view class="bg-white">
		<free-transparent-bar :scrollTop="scrollTop"/>
		<view class="position-relative" style="height: 620rpx;">
			<image src="/static/images/demo/1.jpg" mode="aspectFill" style="height: 590rpx;" class="bg-secondary"></image>
			<image src="/static/images/demo/demo6.jpg" style="width: 120rpx;height: 120rpx;right: 30rpx;" class="bg-secondary rounded position-absolute bottom-0"></image>
			<text class="position-absolute text-white font-md" style="bottom: 45rpx;right: 160rpx;">Âº†Ê≥¢</text>
		</view>
		
		<!-- ÊúãÂèãÂúàÂàóË°® -->
		<free-moment-list 
			v-for="(item, index) in list"
			:key="index"
			:item="item"
			:index="index"
			@action="openAction"
		></free-moment-list>
		
		<!-- Êìç‰ΩúËèúÂçïÂºπÂá∫Â±Ç -->
		<free-popup ref="action" maskColor bottom transformOrigin="center bottom" >
			<view class="bg-light border-top flex align-center px-3" style="height: 105rpx;">
				<textarea ref="textareaRef" fixed class="bg-white rounded p-2 font-md" style="height: 75rpx;width: 520rpx;" v-model.trim="content" focus/>
				<free-icon-button :iconValue="'\ue605'" @click="changeFaceModal" />
				<free-mail-button :disabled="content.length===0" name="ÂèëÈÄÅ" @click="send"></free-mail-button>
			</view>
			<!-- Ë°®ÊÉÖÂåÖÈÉ®ÂàÜ -->
			<scroll-view v-if="faceModal" scroll-y style="height: 350rpx;">
				<view class="bg-light flex flex-wrap">
					<view class="flex justify-center align-center" style="width: 107rpx;height: 107rpx;" hover-class="bg-white" v-for="(item,index) in faceList" :key="index">
						<text @click="handleFaceClick(item)">{{item}}</text>
					</view>
				</view>
			</scroll-view>
		</free-popup>
	</view>
</template>

<script>
	import FreeTransparentBar from '@/components/free-ui/free-transparent-bar.vue'
	import FreeMomentList from '@/components/free-ui/free-moment-list.vue'
	import FreeIconButton from '@/components/free-ui/free-icon-button.vue'
	import FreePopup from "@/components/free-ui/free-popup.vue"
	import FreeMailButton from "@/components/free-ui/free-mail-button.vue"
	export default {
		components: {
			FreeTransparentBar,
			FreeMomentList,
			FreeIconButton,
			FreePopup,
			FreeMailButton
		},
		data() {
			return {
				scrollTop: 0,
				list:[{
					id:2,
					avatar:'/static/images/demo/demo6.jpg',
					username:'Âº†Ê≥¢',
					context:'Èùì‰ªîÔºåÂê¨ËØ¥Ëøô‰∏™Êúà‰ºö‰∏äÁ∫øÔºöÂ§ñÂçñÈÖçÈÄÅÁ≥ªÁªüÂÖ®Ê†àÊïôÁ®ãÔºåÂú®Á∫øÁÇπÊí≠ÂÖ®Ê†àÊïôÁ®ãÔºåÂ§öÁ´ØÂÆ¢ÊúçÁ≥ªÁªüÔºå‰ºÅ‰∏öÁΩëÁõòÁ≥ªÁªü',
					image:[],
					video:false,
					create_time:1567481668,
					supports:[{
						id:1,
						username:"Âº†Ê≥¢",
						avatar:'/static/images/demo/demo6.jpg',
					}],
					comments:[{
						id:1,
						username:"Âº†Ê≥¢",
						content:"ÊàëË¶ÅËøõÂ§ßÂéÇ,ÊàëË¶ÅÂèòÂº∫!!!ÊàëË¶ÅËøõÂ§ßÂéÇ,ÊàëË¶ÅÂèòÂº∫!!!ÊàëË¶ÅËøõÂ§ßÂéÇ,ÊàëË¶ÅÂèòÂº∫!!!ÊàëË¶ÅËøõÂ§ßÂéÇ,ÊàëË¶ÅÂèòÂº∫!!!"
					}]
				},{
					id:2,
					avatar:'/static/images/demo/demo6.jpg',
					username:'Âº†Ê≥¢',
					context:'Èùì‰ªîÔºåÂê¨ËØ¥Ëøô‰∏™Êúà‰ºö‰∏äÁ∫øÔºöÂ§ñÂçñÈÖçÈÄÅÁ≥ªÁªüÂÖ®Ê†àÊïôÁ®ãÔºåÂú®Á∫øÁÇπÊí≠ÂÖ®Ê†àÊïôÁ®ãÔºåÂ§öÁ´ØÂÆ¢ÊúçÁ≥ªÁªüÔºå‰ºÅ‰∏öÁΩëÁõòÁ≥ªÁªü',
					image:[{
						src:"/static/images/demo/1.jpg"
					}],
					video:false,
					create_time:1567481668,
					supports:[],
					comments:[]
				},{
					id:2,
					avatar:'/static/images/demo/demo6.jpg',
					username:'Âº†Ê≥¢',
					context:'Èùì‰ªîÔºåÂê¨ËØ¥Ëøô‰∏™Êúà‰ºö‰∏äÁ∫øÔºöÂ§ñÂçñÈÖçÈÄÅÁ≥ªÁªüÂÖ®Ê†àÊïôÁ®ãÔºåÂú®Á∫øÁÇπÊí≠ÂÖ®Ê†àÊïôÁ®ãÔºåÂ§öÁ´ØÂÆ¢ÊúçÁ≥ªÁªüÔºå‰ºÅ‰∏öÁΩëÁõòÁ≥ªÁªü',
					image:[{
						src:"/static/images/demo/1.jpg"
					},{
						src:"/static/images/demo/1.jpg"
					}],
					video:false,
					create_time:1567481668,
					supports:[],
					comments:[]
				},{
					id:2,
					avatar:'/static/images/demo/demo6.jpg',
					username:'Âº†Ê≥¢',
					context:'Èùì‰ªîÔºåÂê¨ËØ¥Ëøô‰∏™Êúà‰ºö‰∏äÁ∫øÔºöÂ§ñÂçñÈÖçÈÄÅÁ≥ªÁªüÂÖ®Ê†àÊïôÁ®ãÔºåÂú®Á∫øÁÇπÊí≠ÂÖ®Ê†àÊïôÁ®ãÔºåÂ§öÁ´ØÂÆ¢ÊúçÁ≥ªÁªüÔºå‰ºÅ‰∏öÁΩëÁõòÁ≥ªÁªü',
					image:[],
					video:{
						src:"/static/video/demo.mp4",
						poster:"https://douyinzcmcss.oss-cn-shenzhen.aliyuncs.com/shengchengqi/datapic/1.jpg"
					},
					create_time:1567481668,
					supports:[],
					comments:[]
				}],
				content: '',		// ËØÑËÆ∫ËæìÂÖ•Ê°ÜÂÜÖÂÆπ
				isSupports: false,	// ÊòØÂê¶Â∑≤ÁÇπËµû
				faceModal: false,		// ÊòØÂê¶ÊòæÁ§∫Ë°®ÊÉÖÂåÖ
				faceList:["üòÄ","üòÅ","üòÇ","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòã","üòé","üòç","üòò","üòó","üòô","üòö","üòá","üòê","üòë","üò∂","üòè","üò£","üò•","üòÆ","üòØ","üò™","üò´","üò¥","üòå","üòõ","üòú","üòù","üòí","üòì","üòî","üòï","üò≤","üò∑","üòñ","üòû","üòü","üò§","üò¢","üò≠","üò¶","üòß","üò®","üò¨","üò∞","üò±","üò≥","üòµ","üò°","üò†"],
				commentIndex: -1		// ËØÑËÆ∫ÂØπË±°Á¥¢Âºï
			}
		},
		methods: {
			// ÂºÄÂêØ/ÂÖ≥Èó≠Ë°®ÊÉÖÂåÖÈù¢Êùø
			changeFaceModal() {
				uni.hideKeyboard()
				setTimeout(_=>{
					this.faceModal = !this.faceModal
				}, 100)
			},
			
			// ËØÑËÆ∫ÂàóË°®Ë°®ÊÉÖÂåÖÁÇπÂáª‰∫ã‰ª∂
			handleFaceClick(item) {
				// Â∞ÜË°®ÊÉÖÂåÖÊ∑ªÂä†Âà∞ËæìÂÖ•Ê°Ü
				this.content += item
			},
			
			// ÂèëÈÄÅËØÑËÆ∫‰∫ã‰ª∂
			send() {
				this.list[this.commentIndex].comments.push({
					id:22,
					username:"Jack",
					content: this.content
				})
				uni.showToast({
					title: 'ËØÑËÆ∫ÊàêÂäü!'
				})
				this.$refs.action.hide()
			},
			
			// ÁÇπËµûÊìç‰Ωú
			doSupports(e) {
				const {item, index} = e
				this.isSupports = !this.isSupports
				let msg = (this.isSupports ? 'ÁÇπËµû' : 'ÂèñÊ∂àÁÇπËµû') + 'ÊàêÂäü'
				if(this.isSupports) {
					item.supports.push({
						id:666,
						username:"Ê≥¢Âì•",
						avatar:'/static/images/demo/demo6.jpg',
						type: 'self'
					})
				}else {
					let findIndex = item.supports.findIndex(item=>item.type==='self')
					item.supports.splice(findIndex, 1)
				}
				uni.showToast({
					title: msg
				});
			},
			// ÊâìÂºÄÊìç‰ΩúËèúÂçï
			openAction(e) {
				uni.showActionSheet({
					itemList: ['ÁÇπËµû', 'ËØÑËÆ∫'],
					success: res => {
						if(res.tapIndex === 0) {
							// ÁÇπËµûÊìç‰Ωú
							this.doSupports(e)
						}else {
							// ËØÑËÆ∫Êìç‰Ωú
							this.commentIndex = e.index
							this.content = ''
							this.faceModal = false
							this.$refs.action.show()
						}
					}
				});
			}
		},
		onPageScroll(e) {
			this.scrollTop = e.scrollTop
		}
	}
</script>

<style>

</style>
